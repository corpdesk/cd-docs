<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>CORPDESK | Docs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta
        content="Nazox is a fully featured premium Angular 17 admin dashboard template built on top of awesome Bootstrap 5.1.0"
        name="description" />
    <meta content="ThemesDesign" name="author" />
    <!-- App favicon -->
    <link rel="shortcut icon" href="assets/images/favicon.ico">

    <!-- Bootstrap Css -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- Icons Css -->
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css" />
    <!-- App Css-->
    <link href="assets/css/app.min.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/workflow.css" rel="stylesheet" type="text/css" />
    <link href="assets/css/code-button.css" rel="stylesheet" type="text/css" />

</head>

<body data-sidebar="dark">

    <!-- Begin page -->
    <!-- Begin page -->
    <div id="layout-wrapper">

        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="index.html" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="assets/images/logo-sm-light.png" alt="" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="assets/images/logo-light.png" alt="" height="20">
                            </span>
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- ========== Left Sidebar Start ========== -->
        <div class="vertical-menu">
            <div data-simplebar class="h-100">
                <!--- Sidemenu -->
                <div id="sidebar-menu">
                    <ul class="metismenu list-unstyled" id="side-menu">
                        <li class="menu-title">Docs</li>
                        <li>
                            <a href="index.html" class="waves-effect">
                                <i class="mdi mdi-file-document-box-outline"></i>
                                <span>Introduction</span>
                            </a>
                        </li>
                        <li>
                            <a href="processing-request-generic.html" class="waves-effect">
                                <i class="mdi mdi-file-document-box-outline"></i>
                                <span>Process Request - Generic</span>
                            </a>
                        </li>
                        <li>
                            <a href="process-request-nodejs.html" class="waves-effect">
                                <i class="mdi mdi-file-document-box-outline"></i>
                                <span>Process Request - Node.js</span>
                            </a>
                        </li>
                        <li>
                            <a href="directory-structure.html" class="waves-effect">
                                <i class="mdi mdi-file-document-box-outline"></i>
                                <span>Directory Structure</span>
                            </a>
                        </li>
                        <li>
                            <a href="corpdesk-crud.html" class="waves-effect">
                                <i class="mdi mdi-file-document-box-outline"></i>
                                <span>Module CRUD</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- Left Sidebar End -->

        <!-- ============================================================== -->
        <!-- Start right Content here -->
        <!-- ============================================================== -->
        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    <!-- start page title -->
                    <div class="row">
                        <div class="col-12">
                            <div class="page-title-box d-flex align-items-center justify-content-between">
                                <h4 class="mb-0 font-size-18">API Request Processing</h4>
                                <div class="page-title-right">
                                    <ol class="breadcrumb m-0">
                                        <li class="breadcrumb-item"><a href="javascript: void(0);">API</a></li>
                                        <li class="breadcrumb-item">Request Processing</li>
                                        <li class="breadcrumb-item active">Node.js</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- end page title -->

                    <div class="card">
                      <div class="card-body">
                        <div class="p-lg-3">
                          <h5>API Request Processing(Node.js)</h5>
        
                          <!-- Introduction -->
                          <p>
                            Corpdesk API is designed with simplicity and automation in
                            mind. This guide explains the step-by-step process of how
                            requests are handled, from the entry point to the response
                            generation. Comments are used extensively to clarify each
                            stage.
                          </p>
        
                          <!-- package.json -->
                          <h6>Step 1: Initializing the Application</h6>
                          <p>
                            The application starts with the configuration defined in
                            <code>package.json</code>. Below is the key setup:
                          </p>
                          <div class="code-container">
                            <button class="copy-btn" onclick="copyToClipboard(this)">
                              Copy
                            </button>
                            <pre><code class="language-json">
                            {
                                "scripts": {
                                    "start": "DEBUG=wss:* ts-node ./src/app.ts"
                                }
                            }
                                            </code></pre>
                          </div>
        
                          <!-- app.ts -->
                          <h6>Step 2: Launching the Application</h6>
                          <p>
                            The entry point of the application is <code>app.ts</code>.
                            It initializes and runs the main process:
                          </p>
                          <div class="code-container">
                            <button class="copy-btn" onclick="copyToClipboard(this)">
                              Copy
                            </button>
                            <pre><code class="language-javascript">
                            import { Main } from './main';
                            const app = new Main();
                            app.run();
                                            </code></pre>
                          </div>
        
                          <!-- Main -->
                          <h6>Step 3: Configuring Main Settings</h6>
                          <p>
                            The <code>Main</code> class handles environment-specific
                            configurations for CORS, SSL, and the API or WebSocket
                            server:
                          </p>
                          <div class="code-container">
                            <button class="copy-btn" onclick="copyToClipboard(this)">
                              Copy
                            </button>
                            <pre><code class="language-javascript">
                            export class Main {
                                async run() {
                                    app.post(config.apiRoute, async (req, res) => {
                                        res.setHeader('Content-Type', 'application/json');
                                        CdInit(req, res, ds);
                                    });
                            
                                    if (config.pushService.sio.enabled) {
                                        // Run as cd-sio using Socket.IO
                                    }
                                    if (config.pushService.wss.enabled) {
                                        // Run cd-sio using WebSocket (WSS)
                                    }
                                }
                            }
                                            </code></pre>
                          </div>
        
                          <!-- CdInit -->
                          <h6>Step 4: Initializing Requests</h6>
                          <p>
                            Requests are processed using the
                            <code>CdInit</code> function. It validates and routes
                            requests for further processing:
                          </p>
                          <div class="code-container">
                            <button class="copy-btn" onclick="copyToClipboard(this)">
                              Copy
                            </button>
                            <pre><code class="language-javascript">
                            import { CdRequest } from './sys/utils/request';
                            const cdr = new CdRequest();
                            import { CdExec } from './CdExec';
                            
                            export async function CdInit(req, res, ds = null) {
                                await cdr.processPost(req, res, async () => {
                                    const cb = new CdExec();
                                    await cb.exec(req, res, ds);
                                });
                            }
                                            </code></pre>
                          </div>
        
                          <!-- CdExec -->
                          <h6>Step 5: Executing Requests</h6>
                          <p>
                            The <code>CdExec</code> class processes the request payload,
                            resolves the appropriate module, controller, and action, and
                            generates a response:
                          </p>
                          <div class="code-container">
                            <button class="copy-btn" onclick="copyToClipboard(this)">
                              Copy
                            </button>
                            <pre><code class="language-javascript">
                            import { BaseService } from './sys/base/base.service';
                            import { Logging } from './sys/base/winston.log';
                            
                            export class CdExec {
                                constructor() {
                                    this.b = new BaseService();
                                    this.logger = new Logging();
                                }
                            
                                async exec(req, res, ds = null) {
                                    if (await this.b.valid(req, res)) {
                                        try {
                                            const pl = req.post;
                                            const ePath = this.b.entryPath(pl);
                                            const clsCtx = {
                                                path: ePath,
                                                clsName: `${pl.c}Controller`,
                                                action: pl.a,
                                                dataSource: ds
                                            };
                                            await this.b.resolveCls(req, res, clsCtx);
                                        } catch (e) {
                                            await this.b.returnErr(req, res, { messages: e, code: 'CdExec:exec:01', app_msg: '' });
                                        }
                                    } else {
                                        await this.b.returnErr(req, res, { messages: this.b.err, code: 'CdExec:exec:02', app_msg: '' });
                                    }
                                }
                            }
                                            </code></pre>
                          </div>
        
                          <!-- BaseService.resolveCls -->
                          <h6>Step 6: Resolving and Executing Controller Actions</h6>
                          <p>
                            The <code>resolveCls</code> method in
                            <code>BaseService</code> is the bootstrap for all API call
                            executions. It dynamically imports the target controller,
                            initializes it, and invokes the specified action (method).
                            This method not only ensures consistency in handling
                            requests but also sets the stage for how the Corpdesk
                            framework facilitates interaction between controllers,
                            services, and models.
                          </p>
                          <p>Here’s how <code>resolveCls</code> works:</p>
                          <div class="code-container">
                            <button class="copy-btn" onclick="copyToClipboard(this)">
                              Copy
                            </button>
                            <pre><code class="language-javascript">
                            async resolveCls(req, res, clsCtx) {
                                try {
                                    const eImport = await import(clsCtx.path);  // Dynamically import the target controller.
                                    const eCls = eImport[clsCtx.clsName];       // Extract the target class from the module.
                                    const cls = new eCls();                     // Initialize the controller instance.
        
                                    this.ds = clsCtx.dataSource;               // Assign the data source (if provided).
        
                                    if (this.sess) {
                                        req.post.sessData = this.sess;         // Attach session data to the request payload.
                                    }
        
                                    /**
                                    * Invoke the specified action (method) within the controller.
                                    * The controller internally interacts with its associated service
                                    * to handle business logic and data processing.
                                    */
                                    return await cls[clsCtx.action](req, res);
                                } catch (e) {
                                    this.serviceErr(req, res, e, "BaseService:resolveCls");
                                }
                            }
                                </code></pre>
                          </div>
        
                          <h6>
                            Expanding the Framework: Modules, Services, and Models
                          </h6>
                          <p>
                            Once the controller's action is invoked, the following
                            sequence takes place:
                          </p>
                          <ul>
                            <li>
                              <strong>Controller-Service Interaction:</strong> Each
                              controller delegates the execution of business logic to
                              its associated service class. The service class is
                              tailored to handle operations related to the specific
                              module.
                            </li>
                            <li>
                              <strong>Service Dependencies:</strong> Services rely on:
                              <ul>
                                <li>
                                  Module-specific models for interacting with the
                                  database.
                                </li>
                                <li>
                                  Common methods and utilities available in the
                                  <code>BaseService</code>.
                                </li>
                                <li>
                                  Internal methods designed for intra-module operations.
                                </li>
                                <li>
                                  Inter-module calls for invoking actions or services in
                                  other modules.
                                </li>
                              </ul>
                            </li>
                            <li>
                              <strong>Model Interaction:</strong> Models serve as the
                              gateway to the database. They provide structured access to
                              module-specific data and enforce relationships between
                              entities.
                            </li>
                          </ul>
        
                          <p>
                            The process ensures that any module in the Corpdesk
                            framework can interact seamlessly with its own components
                            (intra-module operations) as well as components from other
                            modules (inter-module operations). This design makes the
                            framework highly extensible and maintains consistency across
                            all modules.
                          </p>
        
                          <h6>Transition to Modules</h6>
                          <p>
                            This explanation introduces the core principles of how
                            modules, controllers, services, and models work together in
                            Corpdesk. To dive deeper into how modules are designed, how
                            inter-module calls are handled, and how services rely on
                            models, a dedicated page on
                            <strong>Modules in Corpdesk</strong> will provide a
                            comprehensive guide.
                          </p>
        
                          <h6>Conclusion</h6>
                          <p>
                            By combining modularity with dynamic execution, Corpdesk
                            ensures that any action in any controller can be seamlessly
                            invoked while maintaining a consistent structure for
                            responses and error handling.
                          </p>
                        </div>
                      </div>
                    </div>
                    <!-- end of card -->
                </div>
            </div>
        </div>
        <script src="assets/libs/jquery/jquery.min.js"></script>
        <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    </div>
    <!-- END layout-wrapper -->

    <!-- JAVASCRIPT -->
    <script src="assets/libs/jquery/jquery.min.js"></script>
    <script src="assets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/libs/metismenu/metisMenu.min.js"></script>
    <script src="assets/libs/simplebar/simplebar.min.js"></script>
    <script src="assets/libs/node-waves/waves.min.js"></script>

    <!-- Prism CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/themes/prism.min.css" rel="stylesheet">
    <!-- Prism JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.28.0/prism.min.js"></script>

    <!-- Highlight.js CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css" rel="stylesheet">
    <!-- Highlight.js JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>



    <script src="assets/js/app.js"></script>
    <script src="assets/js/code-button.js"></script>

</body>

</html>